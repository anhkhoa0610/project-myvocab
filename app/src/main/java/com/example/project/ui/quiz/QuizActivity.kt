package com.example.project.ui.quiz\n\nimport android.os.Bundle\nimport android.widget.Button\nimport android.widget.RadioButton\nimport android.widget.RadioGroup\nimport android.widget.TextView\nimport android.widget.Toast\nimport androidx.appcompat.app.AppCompatActivity\nimport com.example.project.R\nimport com.example.project.data.local.DatabaseHelper\nimport com.example.project.data.local.QuizDAO\nimport com.example.project.data.model.QuizQuestion\nimport com.example.project.utils.UserSession\n\nclass QuizActivity : AppCompatActivity() {\n\n    private lateinit var questionTextView: TextView\n    private lateinit var optionsRadioGroup: RadioGroup\n    private lateinit var submitButton: Button\n\n    private lateinit var quizDAO: QuizDAO\n    private var currentQuestionIndex = 0\n    private var score = 0\n    private var questions: List<QuizQuestion> = emptyList()\n    private var quizId: Int = -1\n    private var userId: Int = -1\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_quiz)\n\n        questionTextView = findViewById(R.id.questionTextView)\n        optionsRadioGroup = findViewById(R.id.optionsRadioGroup)\n        submitButton = findViewById(R.id.submitButton)\n\n        quizDAO = QuizDAO(DatabaseHelper(this))\n        quizId = intent.getIntExtra(\"QUIZ_ID\", -1)\n        userId = UserSession.getUserId(this)\n\n        if (quizId != -1) {\n            questions = quizDAO.getQuestionsForQuiz(quizId)\n            displayQuestion()\n        }\n\n        submitButton.setOnClickListener {\n            checkAnswer()\n        }\n    }\n\n    private fun displayQuestion() {\n        if (currentQuestionIndex < questions.size) {\n            val question = questions[currentQuestionIndex]\n            questionTextView.text = question.question\n\n            optionsRadioGroup.removeAllViews()\n            question.options.forEach {\ option ->\n                val radioButton = RadioButton(this)\n                radioButton.text = option\n                optionsRadioGroup.addView(radioButton)\n            }\n        } else {\n            // End of quiz\n            quizDAO.saveQuizResult(quizId, userId, score)\n            Toast.makeText(this, \"Quiz finished! Your score: $score/${questions.size}\", Toast.LENGTH_SHORT).show()\n            finish()\n        }\n    }\n\n    private fun checkAnswer() {\n        val selectedRadioButtonId = optionsRadioGroup.checkedRadioButtonId\n        if (selectedRadioButtonId != -1) {\n            val selectedRadioButton = findViewById<RadioButton>(selectedRadioButtonId)\n            val selectedAnswer = selectedRadioButton.text.toString()\n\n            if (selectedAnswer == questions[currentQuestionIndex].answer) {\n                score++\n            }\n\n            currentQuestionIndex++\n            displayQuestion()\n        } else {\n            Toast.makeText(this, \"Please select an answer\", Toast.LENGTH_SHORT).show()\n        }\n    }\n}\n